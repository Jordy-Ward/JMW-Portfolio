# Production configuration - uses environment variables
# All values come from Railway environment variables

# Database Configuration - from environment variables
spring.datasource.url=${DATABASE_URL}
spring.datasource.username=${DATABASE_USERNAME}
spring.datasource.password=${DATABASE_PASSWORD}
spring.datasource.driver-class-name=org.postgresql.Driver

# Connection Pool Settings - EMERGENCY FIXES for prepared statement conflicts
spring.datasource.hikari.connection-timeout=${CONNECTION_TIMEOUT:30000}
spring.datasource.hikari.maximum-pool-size=${MAX_POOL_SIZE:3}
spring.datasource.hikari.minimum-idle=${MIN_IDLE:1}
spring.datasource.hikari.idle-timeout=${IDLE_TIMEOUT:600000}
spring.datasource.hikari.max-lifetime=${MAX_LIFETIME:1800000}
spring.datasource.hikari.leak-detection-threshold=60000
spring.datasource.hikari.validation-timeout=5000

# Security - disable H2 console in production
spring.h2.console.enabled=${H2_CONSOLE_ENABLED:false}

# JPA/Hibernate Configuration - EMERGENCY FIXES for prepared statement conflicts
spring.jpa.database-platform=${JPA_DIALECT:org.hibernate.dialect.PostgreSQLDialect}
spring.jpa.hibernate.ddl-auto=${DDL_AUTO:update}
spring.jpa.show-sql=${SHOW_SQL:false}
spring.jpa.properties.hibernate.jdbc.lob.non_contextual_creation=true
# Cloud optimizations - prevent connection pool exhaustion
spring.jpa.open-in-view=${OPEN_IN_VIEW:false}
spring.jpa.properties.hibernate.connection.provider_disables_autocommit=true

# CRITICAL: Fix prepared statement conflicts
spring.jpa.properties.hibernate.connection.release_mode=after_transaction
spring.jpa.properties.hibernate.jdbc.use_get_generated_keys=false
spring.jpa.properties.hibernate.temp.use_jdbc_metadata_defaults=false
spring.jpa.properties.hibernate.connection.handling_mode=delayed_acquisition_and_release_after_transaction

# Transaction Management - fix autoCommit issues
# Database transaction and connection settings
spring.jpa.properties.hibernate.connection.autocommit=false
spring.datasource.hikari.auto-commit=false
spring.jpa.properties.hibernate.connection.isolation=2
spring.jpa.properties.hibernate.jdbc.batch_size=0
spring.jpa.properties.hibernate.order_inserts=false
spring.jpa.properties.hibernate.order_updates=false

# CORS - configurable frontend URL
spring.web.cors.allowed-origins=${FRONTEND_URL:http://localhost:3000}